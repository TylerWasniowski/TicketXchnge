language: python
dist: xenial
python: "3.7"
services: mysql
env: DJANGO=2.1.2 DB=sqlite3
branches:
  only:
  - master
  - travis-ci-update
before_install: 
  - pip install pipenv
  - sudo mysql -e "use mysql; update user set authentication_string=PASSWORD('new_password') where User='root'; update user set plugin='mysql_native_password';FLUSH PRIVILEGES;"
  - sudo mysql_upgrade -u root -pnew_password
  - sudo service mysql restart
  - mysql -e 'CREATE DATABASE IF NOT EXISTS ticketx;'
install: 
  - pipenv run pip install pip==18.0
  - pipenv install --dev --deploy
  - cd server
script: python manage.py migrate --run-syncdb
